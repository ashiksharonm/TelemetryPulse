services:
  # 1. API Service
  - type: web
    name: telemetry-api
    plan: free
    env: python
    buildCommand: pip install --upgrade pip setuptools wheel && pip install -r requirements.txt
    startCommand: uvicorn src.api.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: KAFKA_BOOTSTRAP_SERVERS
        sync: false
      - key: PYTHONPATH
        value: /opt/render/project/src
      # Add Kafka/SSL placeholders...

  # 2. Stream Processor
  - type: web
    name: stream-processor
    plan: free
    env: python
    buildCommand: pip install --upgrade pip setuptools wheel && pip install -r requirements.txt
    startCommand: python src/processor_main.py
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: KAFKA_BOOTSTRAP_SERVERS
        sync: false
      - key: PYTHONPATH
        value: /opt/render/project/src

  # 3. Producer Simulator
  - type: web
    name: producer-simulator
    plan: free
    env: python
    buildCommand: pip install --upgrade pip setuptools wheel && pip install -r requirements.txt
    startCommand: python src/simulator_main.py
    envVars:
      - key: KAFKA_BOOTSTRAP_SERVERS
        sync: false
      - key: EVENTS_PER_SECOND
        value: "2"
      - key: PYTHONPATH
        value: /opt/render/project/src
